import { useEffect, useState, useCallback, memo } from "react";
import ContentWrapper from "../../../components/ContentWrapper";
import { Tabs, Input, Select, Image } from "antd";
import TabPane from "antd/es/tabs/TabPane";
import Repository from "../../repo/Repository";
import Simulation from "../../repo/simulation/Simulation";
import Image360 from "../../repo/Image/Image";
import Video from "../../repo/360video/Video";
import searchIcon from "../../../assets/icons/search.svg";
import { SearchOutlined } from "@ant-design/icons";
import { useAppSelector } from "../../../store/config/redux";

const TAB_CONFIG = {
  1: {
    component: Repository,
    label: "3D Models",
    icon: (
      <svg width="14" height="16" viewBox="0 0 20 22" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M10 0L19.5 5.5V16.5L10 22L0.5 16.5V5.5L10 0ZM3.49388 6.0777L10.0001 9.8444L16.5062 6.07774L10 2.311L3.49388 6.0777ZM2.5 7.81329V15.3469L9.0001 19.1101V11.5765L2.5 7.81329ZM11.0001 19.11L17.5 15.3469V7.81337L11.0001 11.5765V19.11Z" />
      </svg>
    ),
  },
  2: {
    component: Simulation,
    label: "Simulations",
    icon: (
      <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path
          d="M17.75 21.5H14.75C14.2848 21.4995 13.8311 21.3551 13.4512 21.0866C13.0713 20.818 12.7838 20.4384 12.6283 20H9.3725C9.21686 20.4386 8.92929 20.8182 8.54925 21.0868C8.16922 21.3553 7.71536 21.4997 7.25 21.5H4.25C2.18225 21.5 0.5 19.8177 0.5 17.75V14.75C0.5 12.6823 2.18225 11 4.25 11H17.75C19.8177 11 21.5 12.6823 21.5 14.75V17.75C21.5 19.8177 19.8177 21.5 17.75 21.5ZM8.75 18.5H13.25C13.4489 18.5 13.6397 18.579 13.7803 18.7197C13.921 18.8603 14 19.0511 14 19.25C14 19.6632 14.3368 20 14.75 20H17.75C18.9905 20 20 18.9905 20 17.75V14.75C20 13.5095 18.9905 12.5 17.75 12.5H4.25C3.0095 12.5 2 13.5095 2 14.75V17.75C2 18.9905 3.0095 20 4.25 20H7.25C7.66325 20 8 19.6632 8 19.25C8 19.0511 8.07902 18.8603 8.21967 18.7197C8.36032 18.579 8.55109 18.5 8.75 18.5Z"
          stroke="black"
          strokeWidth="0.4"
        />
        <path d="M18.5001 16.25C18.3011 16.25 18.1104 16.171 17.9697 16.0303C17.8291 15.8897 17.7501 15.6989 17.7501 15.5C17.7501 15.0868 17.4133 14.75 17.0001 14.75H16.2501C16.0511 14.75 15.8604 14.671 15.7197 14.5303C15.5791 14.3897 15.5001 14.1989 15.5001 14C15.5001 13.8011 15.5791 13.6103 15.7197 13.4697C15.8604 13.329 16.0511 13.25 16.2501 13.25H17.0001C18.2406 13.25 19.2501 14.2595 19.2501 15.5C19.2501 15.6989 19.171 15.8897 19.0304 16.0303C18.8897 16.171 18.699 16.25 18.5001 16.25ZM5.7508 10.25C5.61593 10.2502 5.48352 10.214 5.3675 10.1452C5.25148 10.0764 5.15615 9.97764 5.09155 9.85925L4.3738 8.54225C4.32385 8.45565 4.29172 8.35993 4.27929 8.26073C4.26687 8.16153 4.2744 8.06085 4.30145 7.9646C4.3285 7.86836 4.37452 7.77849 4.4368 7.70028C4.49909 7.62208 4.57638 7.55712 4.66413 7.50922C4.75188 7.46131 4.84833 7.43144 4.94779 7.42135C5.04726 7.41126 5.14773 7.42116 5.24332 7.45047C5.3389 7.47977 5.42766 7.52789 5.50438 7.59199C5.5811 7.6561 5.64423 7.7349 5.69005 7.82375L6.40855 9.14075C6.47089 9.25498 6.50242 9.38347 6.50007 9.51358C6.49771 9.64369 6.46154 9.77095 6.39511 9.88285C6.32868 9.99475 6.23428 10.0874 6.12118 10.1518C6.00809 10.2162 5.88018 10.25 5.75005 10.25H5.7508ZM3.9553 6.9575C3.82051 6.95773 3.68815 6.92164 3.57214 6.85301C3.45612 6.78438 3.36075 6.68575 3.29605 6.5675L2.57755 5.249C2.48227 5.07435 2.46027 4.86901 2.51639 4.67815C2.57251 4.48728 2.70216 4.32653 2.8768 4.23125C3.05145 4.13597 3.25679 4.11397 3.44765 4.17009C3.63852 4.22621 3.79927 4.35585 3.89455 4.5305L4.61305 5.8475C4.67554 5.9617 4.70722 6.0902 4.70499 6.22036C4.70276 6.35051 4.66669 6.47785 4.60033 6.58984C4.53396 6.70183 4.43959 6.79462 4.3265 6.85909C4.2134 6.92355 4.08548 6.95746 3.9553 6.9575ZM2.15905 3.66575C2.02426 3.66598 1.8919 3.62989 1.77589 3.56126C1.65987 3.49263 1.5645 3.394 1.4998 3.27575L0.782052 1.958C0.734874 1.87152 0.705191 1.7766 0.694698 1.67866C0.684204 1.58071 0.693106 1.48166 0.720894 1.38715C0.777014 1.19628 0.906657 1.03553 1.0813 0.94025C1.25595 0.844971 1.46129 0.822972 1.65215 0.879092C1.84302 0.935212 2.00377 1.06485 2.09905 1.2395L2.8168 2.5565C2.87929 2.6707 2.91097 2.7992 2.90874 2.92936C2.90651 3.05951 2.87044 3.18685 2.80408 3.29884C2.73771 3.41083 2.64334 3.50362 2.53025 3.56808C2.41715 3.63255 2.28923 3.66572 2.15905 3.66575ZM16.2493 10.25C16.1192 10.2499 15.9914 10.216 15.8784 10.1515C15.7654 10.0871 15.6711 9.99441 15.6048 9.88253C15.5385 9.77065 15.5024 9.64344 15.5 9.51339C15.4977 9.38334 15.5292 9.25493 15.5916 9.14075L16.3101 7.82375C16.4053 7.64911 16.5661 7.51946 16.757 7.46334C16.9478 7.40722 17.1532 7.42922 17.3278 7.5245C17.5024 7.61978 17.6321 7.78053 17.6882 7.9714C17.7443 8.16226 17.7223 8.3676 17.6271 8.54225L16.9086 9.85925C16.844 9.97764 16.7486 10.0764 16.6326 10.1452C16.5166 10.214 16.3842 10.2502 16.2493 10.25ZM18.0448 6.9575C17.9147 6.95739 17.7869 6.92346 17.6739 6.85904C17.5609 6.79461 17.4666 6.70191 17.4003 6.59003C17.334 6.47815 17.2979 6.35094 17.2955 6.22089C17.2932 6.09084 17.3247 5.96243 17.3871 5.84825L18.1056 4.53125C18.1527 4.44477 18.2165 4.36844 18.2932 4.3066C18.3698 4.24476 18.4579 4.19863 18.5525 4.17084C18.647 4.14305 18.746 4.13415 18.844 4.14465C18.9419 4.15514 19.0368 4.18482 19.1233 4.232C19.2098 4.27918 19.2861 4.34293 19.348 4.4196C19.4098 4.49628 19.4559 4.58439 19.4837 4.6789C19.5115 4.77341 19.5204 4.87246 19.5099 4.97041C19.4994 5.06835 19.4697 5.16327 19.4226 5.24975L18.7041 6.56675C18.6395 6.68514 18.5441 6.78392 18.4281 6.85268C18.3121 6.92145 18.1797 6.95766 18.0448 6.9575ZM19.8411 3.66575C19.711 3.66564 19.5832 3.63171 19.4702 3.56729C19.3572 3.50286 19.2629 3.41016 19.1966 3.29828C19.1302 3.1864 19.0941 3.05919 19.0918 2.92914C19.0895 2.79909 19.121 2.67068 19.1833 2.5565L19.9011 1.2395C19.9963 1.06485 20.1571 0.935212 20.3479 0.879092C20.5388 0.822972 20.7442 0.844971 20.9188 0.94025C21.0934 1.03553 21.2231 1.19628 21.2792 1.38715C21.3353 1.57801 21.3133 1.78335 21.2181 1.958L20.5003 3.275C20.4356 3.3935 20.3402 3.49235 20.224 3.56113C20.1079 3.6299 19.976 3.66604 19.8411 3.66575ZM11.0113 9.5H11.0001C10.7113 9.5 10.4211 9.47225 10.1376 9.4175C9.94222 9.37971 9.7699 9.26587 9.6585 9.10102C9.54711 8.93618 9.50576 8.73383 9.54355 8.5385C9.58134 8.34317 9.69519 8.17085 9.86003 8.05945C10.0249 7.94806 10.2272 7.90671 10.4226 7.9445C10.6123 7.982 10.8066 8 11.0001 8C11.4141 8 11.7553 8.336 11.7553 8.75C11.7553 9.164 11.4253 9.5 11.0113 9.5ZM13.0896 8.86475C12.9287 8.86511 12.7719 8.81373 12.6425 8.7182C12.5131 8.62267 12.4178 8.48805 12.3707 8.33421C12.3236 8.18038 12.3273 8.01549 12.3811 7.86388C12.4349 7.71227 12.536 7.58198 12.6696 7.49225C12.8331 7.38275 12.9861 7.25675 13.1248 7.11725C13.1944 7.04752 13.2771 6.99218 13.3681 6.95441C13.4592 6.91663 13.5567 6.89715 13.6553 6.89708C13.7538 6.89701 13.8514 6.91635 13.9425 6.954C14.0336 6.99165 14.1163 7.04687 14.1861 7.1165C14.2558 7.18613 14.3111 7.26882 14.3489 7.35984C14.3867 7.45086 14.4061 7.54842 14.4062 7.64697C14.4063 7.74552 14.3869 7.84311 14.3493 7.93418C14.3117 8.02525 14.2564 8.10802 14.1868 8.17775C13.9798 8.38475 13.7518 8.573 13.5081 8.7365C13.3844 8.81977 13.2386 8.86492 13.0896 8.86475ZM8.36005 8.41325C8.16221 8.41346 7.97235 8.33525 7.83205 8.19575C7.62316 7.98866 7.43478 7.76185 7.26955 7.5185C7.15796 7.3537 7.11641 7.15132 7.15403 6.95589C7.19166 6.76045 7.30538 6.58797 7.47018 6.47638C7.63498 6.36479 7.83735 6.32323 8.03279 6.36086C8.22823 6.39848 8.40071 6.5122 8.5123 6.677C8.62255 6.83975 8.7493 6.992 8.88805 7.13075C8.99355 7.23538 9.06559 7.369 9.09503 7.51463C9.12447 7.66027 9.10999 7.81137 9.05343 7.94877C8.99686 8.08617 8.90076 8.20367 8.77731 8.28636C8.65386 8.36906 8.50864 8.41322 8.36005 8.41325ZM14.6796 6.4805C14.5687 6.48059 14.4593 6.45612 14.3591 6.40885C14.2588 6.36159 14.1703 6.2927 14.0999 6.20714C14.0295 6.12159 13.9789 6.02149 13.9518 5.91404C13.9246 5.8066 13.9217 5.69448 13.9431 5.58575C13.9806 5.39375 14.0001 5.1965 14.0001 5C14.0001 4.586 14.3353 4.2275 14.7501 4.2275C15.1641 4.2275 15.5001 4.5425 15.5001 4.95575V4.98125C15.5001 5.294 15.4716 5.58875 15.4146 5.87525C15.381 6.04562 15.2895 6.19909 15.1554 6.30947C15.0214 6.41984 14.8532 6.48029 14.6796 6.4805ZM7.25005 5.7605C6.83605 5.7605 6.50005 5.4365 6.50005 5.02175V5C6.50005 4.715 6.52705 4.43 6.57955 4.15175C6.61665 3.95632 6.72986 3.78363 6.89428 3.67167C7.05871 3.55971 7.26087 3.51765 7.4563 3.55475C7.65173 3.59185 7.82442 3.70506 7.93638 3.86948C8.04834 4.0339 8.0904 4.23607 8.0533 4.4315C8.01781 4.61892 7.99998 4.80925 8.00005 5C8.00005 5.414 7.66405 5.76125 7.25005 5.76125V5.7605ZM14.0968 3.6335C13.9748 3.63376 13.8547 3.60424 13.7467 3.54752C13.6388 3.4908 13.5463 3.40858 13.4773 3.308C13.3662 3.1459 13.2396 2.99494 13.0993 2.85725C13.0273 2.78869 12.9697 2.70651 12.9298 2.61548C12.8899 2.52446 12.8685 2.42641 12.8668 2.32703C12.8651 2.22765 12.8831 2.12893 12.9199 2.0366C12.9567 1.94427 13.0115 1.86017 13.0811 1.7892C13.1507 1.71822 13.2337 1.66179 13.3253 1.62317C13.4168 1.58456 13.5152 1.56453 13.6146 1.56425C13.714 1.56398 13.8124 1.58346 13.9042 1.62157C13.996 1.65968 14.0793 1.71566 14.1493 1.78625C14.3593 1.99175 14.5491 2.219 14.7148 2.45975C14.7919 2.57235 14.8368 2.70386 14.8447 2.8401C14.8526 2.97634 14.8232 3.11216 14.7596 3.23292C14.696 3.35367 14.6007 3.45479 14.4839 3.52538C14.3671 3.59597 14.2333 3.63335 14.0968 3.6335ZM8.3293 3.1175C8.18144 3.11747 8.03688 3.07374 7.9138 2.9918C7.79071 2.90985 7.6946 2.79335 7.63754 2.65694C7.58047 2.52053 7.565 2.3703 7.59307 2.22512C7.62114 2.07995 7.6915 1.94631 7.7953 1.841C8.0008 1.63175 8.2288 1.442 8.4718 1.277C8.63635 1.16877 8.83687 1.1296 9.03006 1.16797C9.22324 1.20634 9.39357 1.31915 9.50428 1.48205C9.61498 1.64495 9.65716 1.84486 9.62171 2.0386C9.58625 2.23234 9.47602 2.40436 9.3148 2.5175C9.15239 2.62798 9.00117 2.75408 8.8633 2.894C8.79361 2.96488 8.7105 3.02115 8.61881 3.05952C8.52712 3.0979 8.4287 3.11761 8.3293 3.1175ZM11.6991 2.0645C11.6533 2.0645 11.6068 2.06075 11.5596 2.05175C11.375 2.01728 11.1877 1.99995 11.0001 2C10.5861 2 10.2336 1.664 10.2336 1.25C10.2336 0.836 10.5531 0.5 10.9671 0.5H11.0001C11.2806 0.5 11.5618 0.52625 11.8363 0.578C12.0192 0.613158 12.1824 0.715095 12.2943 0.863976C12.4062 1.01286 12.4587 1.19803 12.4415 1.38347C12.4244 1.5689 12.3389 1.74134 12.2017 1.86722C12.0644 1.9931 11.8853 2.06342 11.6991 2.0645ZM18.5016 18.5C18.0883 18.5 17.7501 18.164 17.7501 17.75C17.7501 17.336 18.0808 17 18.4941 17H18.5016C18.7005 17 18.8912 17.079 19.0319 17.2197C19.1725 17.3603 19.2516 17.5511 19.2516 17.75C19.2516 17.9489 19.1725 18.1397 19.0319 18.2803C18.8912 18.421 18.7005 18.5 18.5016 18.5Z" />
      </svg>
    ),
  },
  3: {
    component: Video,
    label: "360 Video",
    icon: (
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M16 4C16.5523 4 17 4.44772 17 5V9.2L22.2133 5.55071C22.4395 5.39235 22.7513 5.44737 22.9096 5.6736C22.9684 5.75764 23 5.85774 23 5.96033V18.0397C23 18.3158 22.7761 18.5397 22.5 18.5397C22.3974 18.5397 22.2973 18.5081 22.2133 18.4493L17 14.8V19C17 19.5523 16.5523 20 16 20H2C1.44772 20 1 19.5523 1 19V5C1 4.44772 1.44772 4 2 4H16ZM15 6H3V18H15V6ZM7.4 8.82867C7.47607 8.82867 7.55057 8.85036 7.61475 8.8912L11.9697 11.6625C12.1561 11.7811 12.211 12.0284 12.0924 12.2148C12.061 12.2641 12.0191 12.306 11.9697 12.3375L7.61475 15.1088C7.42837 15.2274 7.18114 15.1725 7.06254 14.9861C7.02169 14.9219 7 14.8474 7 14.7713V9.22867C7 9.00776 7.17909 8.82867 7.4 8.82867ZM21 8.84131L17 11.641V12.359L21 15.1587V8.84131Z" />
      </svg>
    ),
  },
  4: {
    component: Image360,
    label: "360 Images",
    icon: (
      <svg width="14" height="14" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M2 8.1005L4 6.1005L9.5 11.6005L13 8.1005L16 11.1005V2H2V8.1005ZM2 10.9289V16H5.1005L8.0858 13.0147L4 8.9289L2 10.9289ZM7.9289 16H16V13.9289L13 10.9289L7.9289 16ZM1 0H17C17.5523 0 18 0.44772 18 1V17C18 17.5523 17.5523 18 17 18H1C0.44772 18 0 17.5523 0 17V1C0 0.44772 0.44772 0 1 0ZM12.5 7C11.6716 7 11 6.32843 11 5.5C11 4.67157 11.6716 4 12.5 4C13.3284 4 14 4.67157 14 5.5C14 6.32843 13.3284 7 12.5 7Z" />
      </svg>
    ),
  },
};

const SUBJECT_OPTIONS = [
  { key: "1", value: "Science" },
  { key: "2", value: "Social Science" },
  { key: "3", value: "Mathematics" },
];

const ContentRepo = memo(() => {
  const selectedTheme = useAppSelector((state) => state.theme.theme);
  const [activeKey, setActiveKey] = useState(localStorage.getItem("activeTab") || "1");
  const [searchValue, setSearchValue] = useState({
    modelName: "",
    tags: [],
  });

  const handleTabChange = useCallback((key) => {
    setActiveKey(key);
    localStorage.setItem("activeTab", key);
  }, []);

  const handleSearch = useCallback((e) => {
    const { name, value } = e.target;
    setSearchValue((prev) => ({
      ...prev,
      [name]: value,
    }));
  }, []);

  const handleSubjectChange = useCallback((value) => {
    setSearchValue((prev) => ({
      ...prev,
      subject: value,
    }));
  }, []);

  const renderTabContent = useCallback(() => {
    const Component = TAB_CONFIG[activeKey]?.component;
    return Component ? <Component searchValue={searchValue} /> : null;
  }, [activeKey, searchValue]);

  useEffect(() => {
    const savedTab = localStorage.getItem("activeTab");
    if (savedTab) {
      setActiveKey(savedTab);
    }
  }, []);

  const renderSubjectOption = useCallback(
    (option) => (
      <Select.Option key={option.key} value={option.value}>
        <span style={{ color: selectedTheme === "dark" ? "white" : "black" }}>{option.value}</span>
      </Select.Option>
    ),
    [selectedTheme],
  );

  return (
    <ContentWrapper
      header="Content Repository"
      className="flex"
      extra={
        <div className="flex rounded-full gap-2 px-2 py-1">
          <Tabs activeKey={activeKey} onChange={handleTabChange} centered className="content_repo_tab">
            {Object.entries(TAB_CONFIG).map(([key, { label, icon }]) => (
              <TabPane key={key} tab={label} icon={icon} />
            ))}
          </Tabs>
          <div className="flex items-center gap-2">
            <Input
              size="large"
              placeholder="Search"
              className="border-none rounded-xl w-36"
              prefix={<SearchOutlined />}
              name="modelName"
              onChange={handleSearch}
              value={searchValue.modelName}
            />
            <Select
              size="large"
              mode="multiple"
              showArrow
              placeholder="Filter"
              allowClear
              className="filter-select min-w-48"
              maxTagCount="responsive"
              value={searchValue.subject}
              onChange={handleSubjectChange}
            >
              {SUBJECT_OPTIONS.map(renderSubjectOption)}
            </Select>
          </div>
        </div>
      }
    >
      {renderTabContent()}
    </ContentWrapper>
  );
});

ContentRepo.displayName = "ContentRepo";

export default ContentRepo;
